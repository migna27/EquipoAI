<div class="d-flex justify-content-between align-items-center border-top pt-3 mt-4 mb-2">
    <h4 class="text-primary m-0">Visualizaci√≥n Gr√°fica</h4>
    
    <div class="btn-group">
        <button class="btn btn-outline-secondary btn-sm" id="btnSlow" title="Alternar velocidad">
            üêå
        </button>
        <button class="btn btn-warning btn-sm" id="btnPause" title="Pausar/Reanudar">
            ‚è∏
        </button>
    </div>
</div>

<div class="card bg-dark text-white mb-4 shadow" style="overflow: hidden;">
    <div class="card-body p-0 position-relative" id="canvasContainer">
        
        <canvas 
            id="gearCanvas" 
            style="background-color: #1e1e1e; cursor: grab; display: block; width: 100%; height: 400px;"
            data-dientes='{{ resultados.dientes | tojson if resultados and resultados.dientes else "[]" }}'
        ></canvas>
        
        <div class="position-absolute bottom-0 start-0 w-100 d-flex justify-content-between align-items-center px-4 py-2"
            style="background: transparent;">

            
            <div class="d-flex align-items-center gap-4 small text-secondary">
                <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-secondary bg-opacity-25 text-light rounded-pill">#</span>
                    <span class="text-light">Arrastrar</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-secondary bg-opacity-25 text-light rounded-pill">#</span>
                    <span class="text-light">Zoom</span>
                </div>
            </div>

            <div class="d-flex align-items-center gap-3 ms-auto me-3 p-2"
                style="background: rgba(0,0,0,0.25); backdrop-filter: blur(4px); border-radius: 8px;">
                
                <span class="text-light small">üîç</span>

                <input type="range" class="form-range" id="zoomRange" min="0.1" max="3" step="0.1"
                    value="1" style="width: 120px;">

                <button class="btn btn-sm btn-outline-light border-0" 
                    id="btnResetView" 
                    title="Restaurar vista original">
                    ‚ü≤
                </button>
            </div>

        </div>  

    </div>
</div>

<script src="{{ url_for('static', filename='js/engranaje.js') }}"></script>

<script>
function generarYDescargarPDF() {
    console.log("Iniciando generaci√≥n de PDF...");
    const canvas = document.getElementById('gearCanvas');
    const inputImagen = document.getElementById('gear_image_data');
    const form = document.getElementById('pdfForm');

    if (!canvas || !inputImagen || !form) {
        alert("Error cr√≠tico: Faltan elementos en el HTML.");
        return;
    }

    if (!window.gearViz || typeof window.gearViz.drawForCapture !== 'function') {
        alert("Aviso: Refresca la p√°gina (Ctrl+F5) para actualizar los scripts.");
        inputImagen.value = canvas.toDataURL('image/png');
        form.submit();
        return;
    }

    try {
        window.gearViz.drawForCapture();
        inputImagen.value = canvas.toDataURL('image/png');
        form.submit();
    } catch (err) {
        console.error(err);
        alert("Error: " + err.message);
    }
}
</script>